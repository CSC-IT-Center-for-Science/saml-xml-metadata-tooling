<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<title>Jetty Experiment</title>

	<script src="//code.jquery.com/jquery-1.11.3.min.js"></script>
	<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
	<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css">
	<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
</head>
<body>
<div class="container">
	<div class="col-md-12">
		<h1>Jetty Experiment</h1>
	</div>
	<div class="col-sm-12">
		<form id="sessStrFrm" method="post" action="/ctrl/">
		<div class="form-group">
			<input class="form-control" type="text" id="sessionStr" name="sessionStr" />
			<button type="submit" class="btn btn-default">Send</button>
		</div>
		</form>
	</div>
	<div class="col-sm-12">
		<form id="fileFrm" method="post" action="/ctrl/">
		<div class="form-group">
			<input class="form-control" type="file" id="comparable" />
			<button type="submit" class="btn btn-default">Send</button>
		</div>
		</form>
	</div>
</div>
<script type="text/javascript">
	var files;
	
	$( document ).ready(function() {
		$.getJSON("/ctrl/?stat=true", function( data ) {
			$('#sessionStr').val( data.sessStr );
		})
	});
	
	$('#sessStrFrm').on('submit', function ( event ) {
		event.preventDefault();
		var data = {'sessionStr': $('#sessionStr').val() };
		$.post('/ctrl/', data);
	});
	
	function prepareUpload(event)
	{
	  files = event.target.files;
	}
	
	$('input[type=file]').on('change', prepareUpload);
	
	function uploadFiles(event)
	{
	    event.stopPropagation(); // Stop stuff happening
	    event.preventDefault(); // Totally stop stuff happening

	    // START A LOADING SPINNER HERE

	    // Create a formdata object and add the files
	    var data = new FormData();
	    $.each(files, function(key, value)
	    {
	        data.append(key, value);
	    });

	    $.ajax({
	        url: '/ctrl/?files=upload',
	        type: 'POST',
	        data: data,
	        cache: false,
	        dataType: 'json',
	        processData: false, // Don't process the files
	        contentType: false, // Set content type to false as jQuery will tell the server its a query string request
	        success: function(data, textStatus, jqXHR)
	        {
	            if(typeof data.error === 'undefined')
	            {
	                // Success so call function to process the form
	                //submitForm(event, data);
	            }
	            else
	            {
	                // Handle errors here
	                console.log('ERRORS: ' + data.error);
	            }
	        },
	        error: function(jqXHR, textStatus, errorThrown)
	        {
	            // Handle errors here
	            console.log('ERRORS: ' + textStatus);
	            // STOP LOADING SPINNER
	        }
	    });
	}
	
	$('#fileFrm').on('submit', uploadFiles);
	
</script>
</body>
</html>